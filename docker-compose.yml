services:

  php-apache:
    build:
      context: .
    depends_on:
      - "mysql"
    ports:
      - 80:80
    volumes:
      # Codeigniter or Laravel
      - "./public:/var/www/html/"
      - "./:/var/www/"

  mysql:
    image: "mysql:8.0.27"
    # Uncomment line below if you are using a Mac with the M1 chip
    #platform: linux/amd64
    volumes:
      - "./dbdata:/var/lib/mysql"
    command: 
      - "--default-authentication-plugin=mysql_native_password"
    environment:
      MYSQL_ROOT_PASSWORD: "root"
      MYSQL_DATABASE: "db"
      MYSQL_USER: "admin"
      MYSQL_PASSWORD: "admin"

  phpmyadmin:
    image: "phpmyadmin/phpmyadmin"
    depends_on:
      - "mysql"
    ports:
      - 8080:80
    links:
      - "mysql"
    environment:
      PMA_HOST: "mysql"
      PMA_PORT: "3306"
      UPLOAD_LIMIT: "256M"

networks:
  default:
    name: "lamp"
